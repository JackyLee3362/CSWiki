## 4.1 文件系统基础
### 文件的概念
- 文件的定义
    - 以计算机硬盘为载体的存储在计算机上的信息集合
    - 计算机以进程为基本单位进行资源的调度和分配，而在用户进行的输入、输出中，则以文件为基本单位
- ~文件的结构
    - 数据项―是文件系统中最低级的数据组织形式，可分为两种类型
        - 基本数据项
        - 组合数据项
    - 记录
    - 文件
- 文件的属性
    - 名称
    - 标识符
    - 类型
    - 位置
    - 大小
    - 保护
    - 时间、日期和用户标识
- 文件的基本操作
    - 创建文件
    - 写文件
    - 读文件
    - 文件重定位（文件寻址）
    - 删除文件
    - 截断文件
- 文件的打开与关闭
    - 打开文件信息表（open-file table）
    - 文件打开计数器（Open Count）
    - 文件控制块（File Control Block）
    - 每个打开文件都有如下关联信息
        - 文件指针
        - 文件打开计数
        - 文件磁盘位置
        - 访问权限
### 文件的逻辑结构
- 无结构文件（流式文件）
    - 以字节为单位
- 有结构文件（记录式文件）
    - 顺序文件
    - 索引文件
    - 索引顺序文件
    - 直接文件或散列文件（Hash File）
### 目录结构
- 文件控制块（File Control Block，FCB），FCB必须连续存放
    - 基本信息
    - 存取控制信息
    - 使用信息
- 索引结点
    - 存放在磁盘上的索引结点称为磁盘索引结点，UNIX中的每个文件都有一个唯一的磁盘索引结点，主要包括以下几个方面
        - 文件主标识符
        - 文件类型
        - 文件存储权限
        - 文件物理地址
        - 文件长度
        - 文件链接计数
        - 文件存取时间
        - 索引结点编号
        - 状态
        - 访问计数
        - 逻辑设备号
        - 链接指针
- 目录结构
    - 目录层次的操作
        - 搜索
        - 创建文件
        - 删除文件
        - 显示目录
        - 修改目录
    - 目录结构
        - 单级目录结构
        - 两级目录结构
            - 主文件目录（Master File Directory，MFD）
            - 用户文件目录（User File Directory，UFD）
        - 多级目录结构（树型目录结构）
            - 相对路径标识文件
        - 无环图形目录结构
### 文件共享
- 基于索引结点的共享方式（硬链接）
- 利用符号链实现文件共享（软链接）
### 文件保护
- 访问类型
    - 读
    - 写
    - 执行
    - 添加
    - 删除
    - 列表清单
- 访问控制
    - 访问控制列表（Access-Control List，ACL）
    - 用户类型
        - 拥有者
        - 组
        - 其他
    - 口令和密码是另外两种访问控制方法
### 习题
- 1【2010】
- 2【2009】
- 3 从用户的观点看，操作系统引入文件系统的目的是
A 保护用户数据
B 实现对文件的按名存取
C 实现虚拟存储
D 保存用户和系统文档及数据→B
- 6 UNIX操作系统中，输入/输出设备视为→特殊文件
- 12【2012】若一个用户进程通过read系统调用读取一个磁盘文件中的数据，则下列关于该叙述正确的是
① 若该文件的数据不在内存，则该进程进入睡眠等待状态
② 请求read系统调用会导致CPU从用户态切换为核心态
③ read系统调用的参数应包含文件名称→①②，③错误，open才包含文件名称，read包含文件描述符
- 13【2013】用户在删除某文件的过程中，操作系统不可能执行的操作是
A 删除此文件所在的目录
B 删除此文件所在的目录项
C 删除与此文件对应的文件控制块
D 释放与此文件关联的内存缓冲区→A
- 21【2009】设文件F1的当前引用计数值为1，先建立文件F1的符号链接（软连接）文件F2，再建立文件F1的硬链接文件F3，然后删除文件F1。此时，文件F2和文件F3的引用计数值分别是→1，1。建立符号链接时，引用计数值直接复制；建立硬链接时，引用计数值加1。删除操作对于符号链接是不可见的，这并不影响文件系统，当以后再通过符号链接访问时，发现文件不存在，直接删除符号链接；但对于硬链接则不可直接删除，引用计数值减1，若值不为0，则不能删除文件，因为还有其他硬链接指向此文件
- 22【2017】若文件f1的硬链接为f2，两个进程分别打开f1和f2，获得对应的文件描述符为fd1和fd2，则下列叙述正确的是
① f1和f2的读写指针位置保持相同
② f1和f2共享同一个内存索引结点
③ fd1和fd2分别指向各自的用户打开文件表中的一项→②③
- 27【2014】在一个文件被用户进程首次打开的过程中，操作系统需做的是
A 将文件内容读到内存中
B 将文件控制块读到内存中
C 修改文件控制块中的读写权限
D 将文件的数据缓冲区首指针返回给用户进程→B
- 28【2017】某文件系统中，针对每个文件，用户类别分为4类：安全管理员、文件主、文件主的伙伴、其他用户；访问权限分为5种：完全控制、执行、修改、读取、写入。若文件控制块中用二进制位串表示文件权限，为表示不同类别用户对一个文件的访问权限，则描述文件的权限的位数至少应为→20，可以把用户访问权限抽象为一个矩阵，行代表用户，列代表访问权限。这个矩阵有4行5列，1代表true，0代表false，所以需要20位
- 29
- 30【2018】
    - 31【2020】若多个进程共享同一个文件F，则下列叙述中，正确的是
A 各进程只能用「读」方式打开文件F
B 在系统打开文件表中仅有一个表项包含F的属性
C 各进程的用户打开文件表中关于F的表项内容相同
D 进程关闭F时，系统删除F在系统打开文件表中的表项→B
A错误：多个进程可以同时以「读」或「写」的方式打开文件，操作系统并不保证写操作的互斥性，进程可通过系统调用对文件加锁，保证互斥写（读者-写者问题）
B正确：整个系统只有一个系统打开文件表，同一个文件打开多次只需改变引用次数
C错误：用户进程的打开文件表关于同一个文件不一定相同，例如读写指针位置不一定相同
D错误：进程关闭文件时，文件的引用计数器减1，引用计数变为0时才删除系统打开文件表中的表项
- 
