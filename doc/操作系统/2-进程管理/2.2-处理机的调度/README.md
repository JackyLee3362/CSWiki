## 2.2 处理机的调度
### 调度的概念
- 调度的基本概念
    - 处理机调度是对处理机进行分配，即从就绪队列按照一定的算法（公平、高效）选择一个进程并将处理机分配给他运行，以实现进程并发地执行
- 调度层次
    - 作业调度/高级调度
        - 内存与辅存之间的调度
        - 多道批处理系统大多配有作业调度，而其他系统中通常不需要配置作业调度
    - 中继调度/内存调度
        - 作用：提高内存利用率和系统吞吐量
        - 为此将哪些暂时不能运行的进程调至外存等待，把此时的进程状态称为** 挂起态** ，当它们已具备运行条件且内存稍有空闲时，则重新调入内存，并修改其状态为就绪态，挂在就绪队列上等待
    - 进程调度/低级调度
        - 是操作系统中最基本的一种调度，进程调度的频率很高，一般十几毫秒一次
- 三级调度的联系
    - 作业调度为进程活动做准备，进程调度使进程正常活动起来，中级调度将暂时不能运行的进程挂起，中级调度处于作业调度和进程调度之间
    - 作业调度次数少，中级调度次数略多，进程调度频率最高
    - 进程调度是最基本的，不可或缺
### 调度的时机、切换与过程
- 不能进行进程的调度与切换的情况
    - 在处理中断的过程中
    - 进程在操作系统内核程序临界区中
    - 其他需要完全屏蔽中断的原子操作过程中。如加锁、解锁、中断保护现场、恢复等原子操作
- 应该进行进程调度与切换的情况
    - 发生引起调度条件且当前进程无法继续运行下去时，可以马上进行调度与切换
    - 中断处理结束或自陷处理解除后，返回被中断进程的用户态程序执行现场前，若置上请求调度标志，即可马上进行进程调度与切换
### 进程调度方式
- 非剥夺调度方式，又称非抢占方式
- 剥夺调度方式
### 调度的基本准则
- CPU利用率
- 系统吞吐量
- 周转时间
    - 周转时间 = 作业完成时间 - 作业提交时间
    - 平均周转时间 = （作业1周转时间 + ... + 作业n周转时间）/ n
    - 带权周转时间 = 作业周转时间  / 作业实际运行时间
    - 平均带权周转时间 = （作业1带权周转时间 + ... + 作业n带权周转时间）/ n
- 等待时间
- 响应时间
### 典型的调度算法
- 先来先服务调度算法 FCFS
    - 属于不可剥夺算法
    - 优缺点
        - 算法简单，效率低
        - 对长作业有利，对短作业不利
        - 有利于CPU繁忙型作业，不利于I/O繁忙型作业
- 短作业优先算法 SJF
    - 缺点
        - SJF调度算法的平均等待时间、平均周转时间最少
        - 长作业周转时间增加
        - 不能保证紧迫性作业被即使处理
        - 长作业「饥饿」现象
- 优先级调度算法
    - 非剥夺式优先级调度算法
    - 剥夺式优先级调度算法
        - 静态优先级
        - 动态优先级
    - 进程优先级设置
        - 系统进程 > 用户进程
        - 交互型进程 > 非交互型进程（或者前台进程 > 后台进程）
        - I/O型进程 > 计算性进程
- 高响应比优先调度算法
    - ^^**响应比 = （等待时间 + 要求服务时间）/ 要求服务时间**^^^^  ^^ 
- 时间片轮转调度算法
    - 适用于分时系统
    - 时间片的长短通常由下列因素确定：系统响应时间、就绪队列中的进程数目和系统的处理能力
- 多级反馈队列调度算法
    - 是时间片轮转调度算法和优先级调度算法的综合和发展
    - 优点
        - 终端型作业用户：短作业优先
        - 短批处理作业用户：周转时间较短
        - 长批处理作业用户：经过前面几个队列得到部分执行，不会长期得不到处理
### 习题
- 10【2013】
- 16【2009】
- 20【2017】
- 21【2012】
- 22【2016】
- 23【2017】
- 28【2012】 「若某单处理器多进程系统中有多个就绪态进程，则在进程处于临界区时不能进行处理机调度」→错误，只要不破坏临界资源的使用规则，就不会影响处理机的调度
- 29【2011】
- 30【2014】
- 31 【2018】某系统采用基于优先权的非抢占式进程调度策略，完成一次进程调度和进程切换的系统时间开销为1us。在T时刻就绪队列中有3个进程P1、P2和P3，其在就绪队列中的等待时间、需要的CPU时间和优先权如下表所示
进程-等待时间-需要的CPU时间-优先权
P1-30us-12us-10
P2-15us-24us-30
P3-18us-36us-20
若优先权值大的进程优先获得CPU，从T时刻起系统开始进程调度，则系统的平均周转时间为→75us
- 32【2019】
- 33【2020】 
- 综合题10【2016】 

